MODULE_HASH=@MODULE_HASH@
PREFIX=/usr/local

all: build

build:
	gcc -fPIC -O3 -c ${MODULE_HASH}.c
	gcc -fPIC -O3 -c ketama.c

	gcc -shared -o libketama.so.1 ketama.o ${MODULE_HASH}.o
	gcc -O3 -o ketama_test ketama_test.c ketama.o ${MODULE_HASH}.o -lm

install:
	install -d $(PREFIX)/lib64 $(PREFIX)/include
	install libketama.so.1 $(PREFIX)/lib64/
	install ketama.h $(PREFIX)/include/
	cd ${PREFIX}/lib64 && ln -sf libketama.so.1 libketama.so

clean:
	rm -f *.o
	rm -f libketama.so.1
	rm -f ketama_test
	rm -f build-stamp configure-stamp

uninstall:
	rm $(PREFIX)/lib64/libketama.so.1
	rm $(PREFIX)/lib64/libketama.so
	rm $(PREFIX)/include/ketama.h

deinstall: uninstall